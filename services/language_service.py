from typing import Dict, Optional
import json

class LanguageService:
    def __init__(self):
        self.user_languages: Dict[int, str] = {}  # user_id -> language_code
        self.default_language = "en"
        
        # Language translations
        self.translations = {
            "en": {
                # Main menu
                "welcome": "üëã Welcome to BuyerChina, {name}!\n\nI'm here to assist you with:\n‚Ä¢ üîç Product search and sourcing\n‚Ä¢ üè¢ Supplier verification\n‚Ä¢ üõí Purchase assistance\n‚Ä¢ üöö Logistics support\n\nUse the menu below to get started!",
                "search_products": "üîç Search Products",
                "verify_supplier": "üè¢ Verify Supplier", 
                "my_orders": "üõí My Orders",
                "track_shipment": "üì¶ Track Shipment",
                "help": "‚ÑπÔ∏è Help",
                "language": "üåê Language",
                "back_menu": "‚¨ÖÔ∏è Back to Menu",
                
                # Product search
                "product_search_title": "üîç *Product Search*\n\nPlease enter the name or description of the product you're looking for.",
                "products_found": "üîç **Found {count} products:**",
                "no_products": "‚ùå No products found. Try a different search term.",
                "new_search": "üîç New Search",
                'contact_quote': 'üí° *Contact us to get detailed quotes and supplier verification!*\n\nüöö *Logistics and shipping costs are calculated separately based on your location and order volume.*',
                
                # Supplier verification
                "supplier_verification_title": "üè¢ *Supplier Verification*\n\nPlease provide the company name or website you'd like to verify.",
                "verification_report": "üè¢ **Supplier Verification Report**",
                "supplier_not_found": "‚ùå *Supplier Not Found*\n\nWe couldn't find verification data for '{name}'.\n\nüí° *What we can do:*\n‚Ä¢ Manual verification research\n‚Ä¢ On-site inspection services\n‚Ä¢ Business license verification\n‚Ä¢ Factory audit reports\n\nContact our team for custom verification services!",
                "verify_another": "üè¢ Verify Another",
                "risk_assessment": "üîç **Risk Assessment for {name}**",
                "recommended_supplier": "‚úÖ **Recommended Supplier**",
                "proceed_caution": "‚ö†Ô∏è **Proceed with Caution**",
                "high_risk": "‚ùå **High Risk - Not Recommended**",
                
                # Orders
                "no_orders": "üì¶ No orders found.\n\nüí° Start by searching for products and contact us to place your first order!",
                "your_orders": "üì¶ **Your Orders ({count} total)**",
                "order_details": "üìã **Order Details**",
                
                # Tracking
                "track_shipment_title": "üì¶ *Track Shipment*\n\nPlease enter your tracking number:",
                "shipment_tracking": "üì¶ **Shipment Tracking**",
                "tracking_not_found": "‚ùå *Tracking Number Not Found*\n\nWe couldn't find information for tracking number: `{number}`\n\nüí° *Please check:*\n‚Ä¢ Tracking number is correct\n‚Ä¢ Package has been shipped\n‚Ä¢ Try again in a few hours\n\nContact us if you need assistance!",
                "track_another": "üì¶ Track Another",
                "tracking_history": "üìç Tracking History:",
                
                # Language selection
                "select_language": "üåê **Select Language**\n\nChoose your preferred language:",
                "language_changed": "‚úÖ Language changed to English",
                
                # Help
                "help_title": "*BuyerChina Bot Help*",
                "available_commands": "*Available Commands:*",
                "how_to_use": "*How to Use:*",
                
                # Admin panel
                "admin_panel": "üë®‚Äçüíº Admin Panel",
                "admin_dashboard": "üë®‚Äçüíº **BuyerChina Admin Dashboard**",
                "order_statistics": "üìä **Order Statistics:**",
                "total_orders": "Total Orders:",
                "pending_orders": "Pending:",
                "confirmed_orders": "Confirmed:",
                "production_orders": "In Production:",
                "shipped_orders": "Shipped:",
                "delivered_orders": "Delivered:",
                "cancelled_orders": "Cancelled:",
                "total_amount": "üí∞ **Total Amount:**",
                "select_action": "Select an action:",
                "view_all_orders": "View All Orders",
                "view_pending": "Pending Orders",
                "view_active": "Active Orders",
                "order_management": "‚öôÔ∏è Order Management",
                "access_denied": "‚ùå Access denied. Admin privileges required.",
                "orders_list": "üìã **Orders List ({count} total)**",
                "no_orders_found": "üì¶ No orders found.",
                "user_id": "User ID:",
                "google_sheets_button": "üìä Open Google Sheets",
                "sheets_connected": "‚úÖ Connected",
                "sheets_disconnected": "‚ùå Not connected",
                
                # General
                "cancel": "Operation cancelled. Use /start to return to the main menu.",
                "company": "Company:",
                "status": "Status:",
                "location": "Location:",
                "price": "Price:",
                "supplier": "Supplier:",
                "min_order": "Min Order:",
                "platform": "Platform:",
                "created": "Created:",
                "total": "Total:",
                "tracking": "Tracking:",
                "carrier": "Carrier:",
                "origin": "Origin:",
                "destination": "Destination:",
                "weight": "Weight:",
                "dimensions": "Dimensions:",
                "est_delivery": "Est. Delivery:",
            },
            "ru": {
                # Main menu
                "welcome": "üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ BuyerChina, {name}!\n\n–Ø –ø–æ–º–æ–≥—É –≤–∞–º —Å:\n‚Ä¢ üîç –ü–æ–∏—Å–∫–æ–º –∏ –∑–∞–∫—É–ø–∫–æ–π —Ç–æ–≤–∞—Ä–æ–≤\n‚Ä¢ üè¢ –ü—Ä–æ–≤–µ—Ä–∫–æ–π –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤\n‚Ä¢ üõí –ü–æ–º–æ—â—å—é –≤ –ø–æ–∫—É–ø–∫–∞—Ö\n‚Ä¢ üöö –õ–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π\n\n–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ–Ω—é –Ω–∏–∂–µ –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã!",
                "search_products": "üîç –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤",
                "verify_supplier": "üè¢ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞",
                "my_orders": "üõí –ú–æ–∏ –∑–∞–∫–∞–∑—ã", 
                "track_shipment": "üì¶ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ",
                "help": "‚ÑπÔ∏è –ü–æ–º–æ—â—å",
                "language": "üåê –Ø–∑—ã–∫",
                "back_menu": "‚¨ÖÔ∏è –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
                
                # Product search
                "product_search_title": "üîç *–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤*\n\n–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π –≤—ã –∏—â–µ—Ç–µ.",
                "products_found": "üîç **–ù–∞–π–¥–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {count}**",
                "no_products": "‚ùå –¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å.",
                "new_search": "üîç –ù–æ–≤—ã–π –ø–æ–∏—Å–∫",
                'contact_quote': 'üí° *–°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Ä–æ–±–Ω—ã—Ö –∫–æ—Ç–∏—Ä–æ–≤–æ–∫ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤!*\n\nüöö *–õ–æ–≥–∏—Å—Ç–∏–∫–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–∞—à–µ–≥–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è –∏ –æ–±—ä–µ–º–∞ –∑–∞–∫–∞–∑–∞.*',
                
                # Supplier verification
                "supplier_verification_title": "üè¢ *–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞*\n\n–£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ –∏–ª–∏ –≤–µ–±-—Å–∞–π—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏.",
                "verification_report": "üè¢ **–û—Ç—á–µ—Ç –æ –ø—Ä–æ–≤–µ—Ä–∫–µ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞**",
                "supplier_not_found": "‚ùå *–ü–æ—Å—Ç–∞–≤—â–∏–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω*\n\n–ú—ã –Ω–µ —Å–º–æ–≥–ª–∏ –Ω–∞–π—Ç–∏ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ '{name}'.\n\nüí° *–ß—Ç–æ –º—ã –º–æ–∂–µ–º —Å–¥–µ–ª–∞—Ç—å:*\n‚Ä¢ –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ\n‚Ä¢ –£—Å–ª—É–≥–∏ –∏–Ω—Å–ø–µ–∫—Ü–∏–∏ –Ω–∞ –º–µ—Å—Ç–µ\n‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∏–∑–Ω–µ—Å-–ª–∏—Ü–µ–Ω–∑–∏–∏\n‚Ä¢ –û—Ç—á–µ—Ç—ã –∞—É–¥–∏—Ç–∞ —Ñ–∞–±—Ä–∏–∫–∏\n\n–°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞—à–µ–π –∫–æ–º–∞–Ω–¥–æ–π –¥–ª—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö —É—Å–ª—É–≥ –ø—Ä–æ–≤–µ—Ä–∫–∏!",
                "verify_another": "üè¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥—Ä—É–≥–æ–≥–æ",
                "risk_assessment": "üîç **–û—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–æ–≤ –¥–ª—è {name}**",
                "recommended_supplier": "‚úÖ **–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ—Å—Ç–∞–≤—â–∏–∫**",
                "proceed_caution": "‚ö†Ô∏è **–î–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å—é**",
                "high_risk": "‚ùå **–í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ - –ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è**",
                
                # Orders
                "no_orders": "üì¶ –ó–∞–∫–∞–∑—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.\n\nüí° –ù–∞—á–Ω–∏—Ç–µ —Å –ø–æ–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –∏ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏ –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞!",
                "your_orders": "üì¶ **–í–∞—à–∏ –∑–∞–∫–∞–∑—ã (–≤—Å–µ–≥–æ: {count})**",
                "order_details": "üìã **–î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞**",
                
                # Tracking
                "track_shipment_title": "üì¶ *–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≥—Ä—É–∑–∞*\n\n–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:",
                "shipment_tracking": "üì¶ **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≥—Ä—É–∑–∞**",
                "tracking_not_found": "‚ùå *–ù–æ–º–µ—Ä –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω*\n\n–ú—ã –Ω–µ —Å–º–æ–≥–ª–∏ –Ω–∞–π—Ç–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ –Ω–æ–º–µ—Ä—É: `{number}`\n\nüí° *–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:*\n‚Ä¢ –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –Ω–æ–º–µ—Ä–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è\n‚Ä¢ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω –ª–∏ –≥—Ä—É–∑\n‚Ä¢ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–∞—Å–æ–≤\n\n–°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏, –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å!",
                "track_another": "üì¶ –û—Ç—Å–ª–µ–¥–∏—Ç—å –¥—Ä—É–≥–æ–π",
                "tracking_history": "üìç –ò—Å—Ç–æ—Ä–∏—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:",
                
                # Language selection
                "select_language": "üåê **–í—ã–±–æ—Ä —è–∑—ã–∫–∞**\n\n–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–π —è–∑—ã–∫:",
                "language_changed": "‚úÖ –Ø–∑—ã–∫ –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ —Ä—É—Å—Å–∫–∏–π",
                
                # Help
                "help_title": "*–ü–æ–º–æ—â—å BuyerChina Bot*",
                "available_commands": "*–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:*",
                "how_to_use": "*–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:*",
                
                # Admin panel
                "admin_panel": "üë®‚Äçüíº –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å",
                "admin_dashboard": "üë®‚Äçüíº **–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ BuyerChina**",
                "order_statistics": "üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–∫–∞–∑–æ–≤:**",
                "total_orders": "–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤:",
                "pending_orders": "–û–∂–∏–¥–∞—é—Ç:",
                "confirmed_orders": "–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã:",
                "production_orders": "–í –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ:",
                "shipped_orders": "–û—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã:",
                "delivered_orders": "–î–æ—Å—Ç–∞–≤–ª–µ–Ω—ã:",
                "cancelled_orders": "–û—Ç–º–µ–Ω–µ–Ω—ã:",
                "total_amount": "üí∞ **–û–±—â–∞—è —Å—É–º–º–∞:**",
                "select_action": "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:",
                "view_all_orders": "–ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∑–∞–∫–∞–∑–æ–≤",
                "view_pending": "–û–∂–∏–¥–∞—é—â–∏–µ –∑–∞–∫–∞–∑—ã",
                "view_active": "–ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã",
                "order_management": "‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏",
                "access_denied": "‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω. –¢—Ä–µ–±—É—é—Ç—Å—è –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.",
                "orders_list": "üìã **–°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ (–≤—Å–µ–≥–æ: {count})**",
                "no_orders_found": "üì¶ –ó–∞–∫–∞–∑—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.",
                "user_id": "ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:",
                "google_sheets_button": "üìä –û—Ç–∫—Ä—ã—Ç—å Google Sheets",
                "sheets_connected": "‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ",
                "sheets_disconnected": "‚ùå –ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ",
                
                # General
                "cancel": "–û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /start –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é.",
                "company": "–ö–æ–º–ø–∞–Ω–∏—è:",
                "status": "–°—Ç–∞—Ç—É—Å:",
                "location": "–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:",
                "price": "–¶–µ–Ω–∞:",
                "supplier": "–ü–æ—Å—Ç–∞–≤—â–∏–∫:",
                "min_order": "–ú–∏–Ω. –∑–∞–∫–∞–∑:",
                "platform": "–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:",
                "created": "–°–æ–∑–¥–∞–Ω:",
                "total": "–ò—Ç–æ–≥–æ:",
                "tracking": "–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ:",
                "carrier": "–ü–µ—Ä–µ–≤–æ–∑—á–∏–∫:",
                "origin": "–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:",
                "destination": "–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:",
                "weight": "–í–µ—Å:",
                "dimensions": "–†–∞–∑–º–µ—Ä—ã:",
                "est_delivery": "–û–∂–∏–¥. –¥–æ—Å—Ç–∞–≤–∫–∞:",
            }
        }
    
    def set_user_language(self, user_id: int, language_code: str):
        """Set language for a user"""
        if language_code in self.translations:
            self.user_languages[user_id] = language_code
            return True
        return False
    
    def get_user_language(self, user_id: int) -> str:
        """Get user's language, default to English"""
        return self.user_languages.get(user_id, self.default_language)
    
    def get_text(self, user_id: int, key: str, **kwargs) -> str:
        """Get translated text for user"""
        language = self.get_user_language(user_id)
        text = self.translations[language].get(key, self.translations[self.default_language].get(key, key))
        
        # Format with provided arguments
        if kwargs:
            try:
                return text.format(**kwargs)
            except KeyError:
                return text
        return text
    
    def get_available_languages(self) -> Dict[str, str]:
        """Get available languages"""
        return {
            "en": "üá∫üá∏ English",
            "ru": "üá∑üá∫ –†—É—Å—Å–∫–∏–π"
        }
